#+TITLE: DNS서버에 대한 공격
* DNS 서버에 대한 공격의 종류와 실행 방법

대표적으로 다음 네 가지 종류의 공격이 존재
- 존 전송 요청에 의한 등록 정보 수집
- *DNS 캐시 포이즈닝* - 피싱, 파밍등에 악용됨
- 서비스 불능상태를 일으키는 공격
- *DNS 리플렉션 (DNS amp)* 공격 - DDos 공격의 일종

** 1. 존 전송 요구에 의한 등록정보 수집
- DNS 서버는 프라이머리 서버, 세컨더리 서버 2대로 운용할 필요가 있다.
- 양 측 서버의 내용을 동기화하는 것을 존전송이라고 한다. 
- DNS 서버에 대한 이름결정(DNS) 요청은 UDP 53번 포트를 이용한다.
- 존 전송 요청은 TCP 53번을 사용하며 세컨더리 서버에서 프라이머리 서버로 정기적으로 요청한다.
- 그러나 특별한 설정이 없을 경우, *다른 호스트에서도 nslookup 커맨드를 이용해 DNS 질의하는 것이 가능*
- 존 전송 요청을 하는 것으로 타겟 서버의 네트워크 구성이나 서버 구성 등을 알 수 있다. 


** 2. DNS 캐시 포이즈닝 공격
- 세컨더리 DNS서버의 DNS요청에 대해 프라이머리 DNS서버에서 응답이 도착하기 전에 가짜 DNS 응답을 보내서 세컨더리 DNS서버의 캐시를 오염시키는 공격
- 악의적인 DNS 서버는 응답시에 정상적인 내용에 더해 부정한 DNS정보를 추가해서 회신한다. 
- 예를들면 www.test.com 을 문의했는데, 이에 더해 www.test.co.jp 등을 추가해서 회신하는 등
- 참고로 DNS 캐시 포이즈닝 공격을 통해 DNS서버에 해킹 사이트 정보를 등록해 놓고 유저들을 유도하는 것을 파밍이라고 함
- *DNS요청 송신 포트번호* 와 *트랜잭션ID(각 DNS 요청을 식별하기 위한 식별자)가 추측하기 쉬운 경우* 이 공격을 당하기 쉬워진다.
- 또한 로컬PC의 hosts 파일 수정도  같은 목적으로 하는 공격이다. (일반 유저의 PC에 설치된 멀웨어가 이 파일을 수정해서 피싱 사이트로 유도한다.)


** 3. 부정한 요청에 의한 서비스 불능상태를 일으키는 공격
- DNS 서버 사양상의 취약점을 이용하여 부정한 요구를 보냄
- 2002년에 세계에 단 13대 뿐인 루트 DNS서버가 이 공격을 받아서 이 중에 9대가 다운되었던 적이 있음

** 4. DNS 리플렉션(DNS amp) 공격
- 여러 대의 DNS 서버에 송신자 IP를 타겟 DNS서버로 한 요청을 보낸다. (이 때, 응답 메세지의 사이즈를 가능한한 크게 한다.)
- 각 DNS 서버는 송신자 IP를 보고 해당(타겟) 서버에 응답을 보낸다.
- 타겟 DNS서버는 갑자기 많은 DNS응답이 쏟아지므로 서비스 불능상태에 빠지게 된다. 
- DMZ 등에 설치된 DNS 캐시서버가 *인터넷 상의 임의의 서버(호스트)로부터의 쿼리를 무조건적으로 수용* 하는 "*오픈 리졸버*" 상태일 경우 이 공격을 받기 쉽다. 

* DNS 서버에 대한 공격의 대책
** 예방 / 방지
- DNS 서버의 버전을 최신화
- DNS의 송신 포트 번호화 트랜잭션 ID를 랜덤화
- DNSSEC을 사용
- 존 전송 요청을 세컨더리 DNS서버로부터만 받도록 설정하고 존 전송하는 데이터의 범위를 최소한으로 설정
- 취약점 검사
- DNS 캐시서버(세컨더리 서버)가 불필요한 쿼리를 거부하도록 접근 제한 설정

** 탐지 / 추적
- 네트워크 감사형 IDS, IPS 운용

** 회복
- 공격을 받은 원인과 취약점을 특정하고 예방/방지 대책을 실시한다. 
