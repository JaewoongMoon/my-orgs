#+TITLE: 인증 시스템을 구현하는 다양한 기술들


* Kerberos
- 인증 및 암호화 시스템
- Trusted Third Party Authentication (신뢰하는 제삼자 기관에 의한 인증방식)

** 구성요소
- 렐름(realm) : 관리 영역
- 프린시팔(Principals) : 렐름내의 모든 클라이언트 및 서버의 총칭
- KDC (Key Distribution Center) : 신뢰하는 제삼자)

** 동작
- KDC가 서버로의 접속을 요구하는 클라이언트를 인증한다.
- KDC는 공통키로 암호화된 유효기간이 있는 티켓을 발행한다.
- 클라이언트는 KDC로부터 발행받은 티켓을 이용해서 목적서버로 접속한다. 
- 렐름 내에서는 서버와 클라이너트 사이의 인증은 이루어지지 않고, 모두 KDC가 관여하는 제삼자인증이 이루어진다.

** Kerberos를 구성하는 세 개의 서버
하지만 실제로는 모두 하나의 서버에 설치된 경우가 많다. (이 것을 하나로 묶어서 KDC(Key Distribution Center)라고 부른다.)
- 인증서버 (Authentication Server , AS) : KDB에 저장된 인증정보를 바탕으로 사용자를 인증하고 '티켓 부여 티켓(Ticket Granting Ticker ,TGT)' 을 발행한다.  
- 티켓부여서버 (Ticket Granting Server, TGS) : 티켓 부여 티켓을 가진 사용자에게 각 서비스를 이용할 수 있는 티켓을 발행한다. 
- 데이터베이스 서버 (Kerberos DataBase, KDB) : 각 유저 인증정보나 공통키를 보관한다. 

** 커버로스 인증 순서
1. 사용자가 AS에게 TGT를 요청한다.
- 사용자가 AS에게 사용자명과 티켓 부여 서버명을 송신한다.

2. AS가 사용자를 인증하고 TGT를 발행한다.
- AS가 KDB에 등록되어있는 정보를 참조해서, 사용자를 인증한다.
- 인증이 성공하면 KDB에 등록되어있는 해당 사용자의 공통키를 사용해서 *암호화한 TGT*를 발행한다.
- TGT에는 사용자와 AS사이에 사용하는 키(AS키), 사용자와 TGS 사이에서 사용하는 티켓(TGST) 및 TGS키가 포함되어 있다. 

3. 사용자가 TGS에 티켓발행을 요청한다.
- 사용자는 TGT를 자신의 AS키(의문: AS키가 아니라 자신의 공통키가 아닌가?)로 복호화해서 TGST와 TGS키를 얻는다. 
- 사용자는 TGST에 필요한 정보(이용하고 싶은 서비스 명 등)를 추가한 후, 그 것을 TGS키로 암호화한 뒤 TGS에 보낸다. 

4. TGS가 유저를 인증하고, 서비스이용티켓을 발행한다.
- TGS는 유저로부터의 TGST를 복호화한 후 정보를 보고 사용자를 인증한다.
- 인증이 성공하면 사용자가 접속을 요청하는 서버와의 사이에서 사용하는 티켓(ST)를 발행하고 그 것을 KDB에 등록되어 있는 서버의 공통키(S키)로 암호화한다. 
- S키로 암호화된 ST에 목적서버와 통신에 사용하는 공통키(S키2)를 추가한 뒤 TGS키로 암호화한 뒤 사용자에게 보낸다.

5. 사용자가 ST를 이용해서 목적 서버로 접속을 요청한다.
- 유저가 암호화된 ST를 TGS키로 복호화한 후, S키2와 S키로 암호화된 ST를 얻는다. 
- 암호화된 ST에 자신의 정보(유저명, IP주소 등)을 추가한 것을 S키2로 암호화해서 목적서버에 보낸다. 
- (내 생각:이 단계에서 사용자는 S키를 모르는 상태이다. S키를 알면 ST의 내용을 변조할 수 있을테니 해킹방지를 위해서 당연한 것일 수도 있다.)

6. 서버가 사용자를 인증한다.
- 서버는 사용자로부터 받은 티켓을 S키2로 복호화해서 S키로 암호화된 ST를 얻어낸다. 
- 이어서 KDB에 등록된 서버의 공통키(S키)로 ST를 복호화해서 사용자를 인증한다.

** 인증 순서 정리
- 정리하면 인증서버(AS) -> 티켓발부서버(TGS) -> 목적지서버 순서로 세 번의 인증이 이루어진다는 것. 
- 그리고 각 인증단계에서 다음단계의 인증에 필요한 정보를 암호화해서 교환한다는 것. 
- 예를들면, AS가 사용자를 인증하면 TGT를 발행할 때 여기에 다음단계인 티켓발부서버와의 인증에 필요한 TGST나 TGS키 등을 포함해서 사용자에게 전달해주는 식이다. 

