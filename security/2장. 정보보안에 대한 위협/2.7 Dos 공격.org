#+TITLE: Dos 공격

* Dos 공격의 종류와 대책
Dos 공격에는 다음과 같은 종류가 있다.
1. CPU나 메모리 등 시스템 자원을 과부하 상태 혹은 오버플로우 상태로 만든다.
2. 대량의 패킷을 보내 네트워크 대역을 넘치게 한다.
3. 호스트의 보안홀을 이용해서 OS나 특정 어플리케이션을 이상종료 시킨다. 

이 중에 비교적 잘 일어나는 것이 2번이다. 2번은 공격하는 측의 규모가 클수록 피해 규모도 커진다. 
버퍼 오버플로 공격같은 것은 3번에 해당됨.


** 1. SYN Flood 공격
- TCP 접속 개시 요구인 SYN 패킷을 대량으로 보내는 것으로 정상적인 서비스 제공을 방해하는 것
- 위 종류 중 1번에 (규모에 따라서는 2번에) 해당한다. 
- 공격자는 발신자 IP를 위조한 SYN 패킷을 대량으로 보낸다. 
- 서버는 각 발신자IP로 SYN/ACK을 보내지만 당연히 응답은 없다.
- 서버는 각 요구를 테이블에 세팅하고 타임아웃이 될 때까지 기다린다.
- 이윽고 서버의 리소스가 모두 사용되고 정당한 요구에 대해서 서비스를 제공하지 못하게 된다.
- 이 공격은 발신자 IP가 위조되어 있어서 공격자의 IP을 특정하기가 어렵다.

*** 대책
- SYN 쿠키나 SYN Flood 프로텍션 기능을 가진 OS나 방화벽을 사용
- 커넥션 확립시의 타임아웃 시간을 짧게 한다.
- 라우터나 스위치에서 SYN패킷의 대역을 제한한다.

*** SYN 쿠키
- TCP 통신의 정당성을 확인하기 위해, SYN/ACK 패킷의 시퀀스 번호에 심어두는 데이터
- 보통 TCP 헤더를 해시화한 값이 사용된다.
- 클라이언트로부터 SYN패킷을 받은 단계에서는 TCP소켓을 오픈하지 않고, SYN쿠키를 세팅한 SYN/ACK패킷을 클라이언트에게 전송한다.
- 이후, 클라이언트로부터 받은 ACK패킷을 확인하고 정당한 통신일 경우만 소켓을 열어서 TCP 커넥션을 확립한다.

SYN Flood 공격은 옛날부터 사용되어온 Dos공격의 대표격인 공격이다. 

최근의 일반적인 서버OS나 방화벽에는 이 공격에 대한 대책이 마련되어 있으나 완벽하지 않아서 최근에도 피해가 발생하고 있다.

** 2. UDP Flood 공격
- 타겟 서버의 UDP 포트로 사이즈가 큰 대량의 UDP 패킷을 보낸다.
- 위 종류의 1번(규모에 따라서 2번)에 해당한다.
- 또한 사이즈가 아주 작은 UDP 패킷을 대량으로 보내는 수법도 있는데, 이는 주로 방화벽이나 네트웍 기기에 부담을 주기위한 공격이다. 
- UDP는 커넥션리스이므로, 발신자 IP를 위조하는 것이 쉽다.
- 따라서 대부분의 UDP Flood공격의 발신자 IP는 위조되어 있다. 
- 그 결과, 공격자 IP를 특정하기 어렵다.

*** 대책
- 불필요한 UDP 서비스를 중지한다.
- 불필요한 UDP 서비스로의 접근을 방화벽에서 필터링한다.
- 라우터나 스위치에서 UDP 패킷의 대역을 제한한다.

** ICMP Flood (Ping Flood) 공격
- 타겟 호스트에 대해 사이즈가 큰 ICMP echo request (ping)를 대량으로 보내는 공격
- 위 종류의 1번(규모에 따라서 2번)에 해당한다.
- ICMP 도 UDP와 마찬가지로 발신자 IP위조가 쉽고, 따라서 공격자 IP를 특정하기 어렵다.

*** 대책
- 라우터나 방화벽에서 ICMP 패킷을 차단(모든 ICMP패킷을 차단하기 어려우면 타입 코드별로 중계 여부를 설정)
- 위의 방법이 불가능하면 라우터나 스위치에서 ICMP 패킷의 대역 제한을 건다.

** 3. smurf 공격
- 발신자 IP주소를 위조한 ICMP echo request로 타겟 호스트가 접속된 네트워크의 대역을 넘치게 하는 공격
- 공격자는 타겟 호스트의 IP를 발신자 IP로 세팅, 네트워크 세그먼트의 브로드캐스팅 주소로 ICMP echo request를 보낸다.
- 요청을 받은 네트워크 세그멘트의 각 호스트들은 위조된 발신자 IP 주소로 ICMP echo reply를 일제히 보낸다.
- 응답을 회신하는 호스트 수가 많을 수록 대량의 패킷이 일제히 발송된다.
- 그 결과 해당 네트워크는 패킷으로 폭주하게 되어 정당한 패킷에 대해 서비스하지 못하게 된다.

*** 대책
- 라우터나 방화벽에서 ICMP패킷을 차단(적어도 ICMP echo reply는 차단한다)
- 위의 방법이 여의치 않으면 라우터나 스위치에서 ICMP패킷의 대역을 제한한다.
- 브로드캐스팅 주소를 향한 패킷을 차단한다. (공격의 발판이 되지 않도록)

** 4. Connection Flood 공격
- 타겟 호스트의 TCP 포트에 대해 차례차례 커넥션을 확립해 나가는 대량의 프로세스를 기동한다.
- 위의 분류에서는 1에 해당
- 실제로 커넥션을 확립하기 때문에 발신자 IP를 위조하기는 어렵다. 
- 그렇지만 규모에 따라 실제로 호스트에 피해를 입힐 가능성이 높다.

*** 대책
- 호스트의 소켓 오픈 수나 TCP 큐의 할당 수를 늘린다.
- 호스트의 설정으로 같은 IP로부터의 동시접속수를 제한한다.
- 호스트의 이중화 구성이나 로드 발란서등을 사용해 부담분산을 한다.
- 라우터나 방화벽으로 공격자 IP로부터의 패킷을 차단한다.


** 5. DDos 공격
- 미리 준비해둔 인터넷상의 무수한 서버들로부터 일제히 Dos공격을 실시
- 위의 분류에서는 2번에 해당
- 최근에는 봇넷으로 실행하는 경우가 많다. 

*** 대책 
- 충분한 대역을 가진 네트워크를 사용
- 공개 서버 및 경로상의 네트워크 기기의 처리 능력을 향상
- 발신자 IP가 확실히 위조된 패킷(프라이빗 네트워크 IP)이나 브로드 캐스팅 주소로의 패킷은 방화벽에서 차단
- 불필요한 ICMP 패킷, UDP 패킷 차단, 대역제한
- 컨텐츠 델리버리 네트웍(CDN) 서비스를 이용한다. 
- CDN 프로바이더 등이 제공하는 DDos 공격대책 서비스를 이용한다. 

CDN이란 웹 사이트의 정적 컨텐츠를 CDN 서비스 프로바이더가 관리, 운용하는 복수의 서버에 캐싱하고 분산배치 하는 것으로 웹 페이지 표시 속도의 증가와 부담분산을 꾀하는 기술

DNS를 경유한 웹 사이트에 대한 DDos공격을 분산, 완화시키는 효과가 있다. 

** 6. 반사/증폭형 DDos 공격
- 응답패킷을 대량으로 발생시킴
- DNS 리플렉션(DNS amp), smurf 등도 이에 속한다.
- 최근에는 NTP(Network Time Protocol)서버를 발판으로 실행하는 NTP 리플렉터 공격에 많이 발생

*** 공격 순서
- 공격자는 C&C 서버를 통해 봇에 감염된 무수한 좀비 PC에게 공격명령을 내린다.
- 좀비 PC는 타겟인 호스트IP를 발신자 IP로 세팅한다음, 공격에 이용할 NTP서버, 오픈 리졸버(Reflector) 등에게 요청을 보낸다.
- Reflector는 위조된 발신자 IP로 증폭된 응답 패킷을 대량으로 보낸다. 
- 타겟 사이트의 상위 ISP를 포함해서, 인터넷 접속 회선이 폭주상태에 빠져 정상적인 요청을 받을 수 없게 된다. 

*** 기타 특징
- DDos 공격은 명령을 내릴 공격용 에이젼트를 미리 많이 준비(감염시켜둘)해둘 필요가 있지만, 반사형 공격은 TCP/IP의 기본적인 통신 기능을 이용하는 것이므로 이를 준비할 필요가 없다. 공격에 필요한 Reflector는 인터넷에 많이 존재하고 있다. 
- 응답 패킷의 크기가 많이 증폭될 수록 효과적이다. 
- 특히, NTP서버에는 과거에 통신한 600건의 주소를 응답하는 monlist커맨드가 있는데, 이 것을 이용하면 응답패킷의 크기가 요청에 비해 작게는 수십배에서 크게는 수백배로 커진다. 

*** 대책
- 반사/증폭형 DDos공격의 대상이 되기 쉬운 서버 중 외부에 공개할 필요없는 것은 제외시킴
- 이 공격에 악용되기 쉬운 커맨드를 무효화 설정
- 충분한 회선 대역 확보, 네트워크 기기, 서버의 부담 분산등을 포함한 튜닝

** 7. EDos 공격
- Economic Denial of Service
- 스토리지 용량이나 트래픽양에 따라 과금되는 클라우드의 특징을 악용
- 클라우드 이용기업의 경제적인 손실을 노려서 리소스를 대량으로 소비시키는 공격
- 유효한 대책이 없는 상황임


* Dos 공격에의 종합적인 대책
** 예방 / 방지
- 라우터나 스위치에서 프로토콜 별 대역제한
- CDN 서비스를 이용

** 탐지 / 추적
- IDS, IPS 기능

** 회복
- 라우터나 방화벽으로 차단
 - 공격 경로가 확실해 지면 상위 프로바이더에 연락해서 해당 대역으로부터의 패킷을 제한

