'#+TITLE: 파이어 월

* 파이어 월의 개요
파이어월을 사용함으로서
- 네트워크 경계에서 일정 레벨의 기밀성을 확보할 수 있다. 
- 불필요한 패킷을 차단하므로 네트워크의 이용효율이 올라간다(가용성 향상)

원래는 ACL에 근거해서 접근제한을 하는 제품을 파이어월이라고 불렀으나 최근에는 IPS, WAF, 개인 방화벽 등이 나오면서 경계가 애매해지고 있다.
- 기존의 파이어월을 '네트워크 파이어월', 어플리케이션에 대해 파이어월 기능을 수행하는 것을 '어플리케이션 파이어월'로 부르기도 한다. 

** 공격을 탐지/방어하는 기술(제품)의 종류

| 제품의 종류              | 특징                                                                                                                                              |
|--------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------|
| 파이어월                 | 주로 TCP/IP계층에서 설정된 룰(IP주소, 포트 번호)에 따라 필터링 수행, 허가된 프로토콜의 취약점을 악용한 공격은 막을 수 없음                        |
| 네트워크형 IDS(NIDS)     | 접속된 네트워크 세그먼트를 흘러다니는 패킷을 감시하고, 포트스캔, BOF공격, DOS공격, 부정커맨드 실행 등을 탐지한다. 암호화된 패킷은 감시할 수 없다. |
| 호스트형 IDS(HIDS)       | 특정 호스트에 상주하면서 로그인성공/실패, 중요자원에 대한 접근등을 탐지                                                                           |
| 침입방어시스템(IPS)      | 기존의 NIDS 기능을 강화, 인라인 접속 구성을 하는 것으로 강력한 침입탐지/방어 기능을 갖춘 제품                                                     |
| 호스트형 침입탐지 시스템 | HIDS에서 방어기능을 추가, 웜이나 스파이웨어의 침입이나 실행을 탐지하고 방어하는 기능                                                              |
| 웹 어플리케이션 파이어월 | 웹 어플리케이션에 대한 공격을 탐지하고 차단, SSL 억셀레이터나 부하분산 기능을 가진 종류도 있다. SSL/TLS 암호화된 패킷을 복호화해서 공격을 탐지/차단 가능 |
| 샌드박스             | 실제환경과 격리된 안전한 가상환경에서 의심스러운 파일이나 URL 링크로의 접속 등을 수행, 그 결과를 감시하는 것으로 멀웨어 등을 탐지한다. MTA로 동작해서 의심스러운 메일을 차단하거나 RTS패킷을 보내서 의심스러운 웹 통신을 차단하거나 한다.         |

** 파이어월의 역할
- 파이어월은 원래 인터넷으로부터의 부정접근공격 등 주로 인바운드방향의 패킷으로부터 조직내부 네트워크를 막는 '방패'가 주된 역할
- 조직 내의 PC가 멀웨어 등에 감염되어 인터넷 상으로 공격을 하는 경우가 발생하기 시작함
- 때문에 아웃바운드 패킷을 필터링하는 것도 중요한 역할이 되었음
- 또한, 기업의 기간 네트워크가 1G~10Gbps 에 달하는 등 고속 이더넷을 사용하는 경우가 많아짐에 따라 
- 그에 맞춰 하이퍼포먼스(고성능), 하이어베일러빌리티(HA:고가용성)가 요구되고 있다. 

* 파이어 월의 기본적인 구성
** 공개 서버를 배리어 세그멘트에 접속

** 공개 서버를 내부 네트워크에 접속
- 공개 서버가 탈취되면 내부 네트워크에 속한 다른 서버들도 모두 탈취될 수 있는 위험성이 있음

** 2대의 FW에 둘러쌓여진 DMZ에 공개 서버를 접속

** FW에 설정한 제3자 세그먼트에 공개 서버를 접속
- FW 한대만으로 구성이 가능하고 내부 네트웍과 분리할 수 있으므로 경제성 및 효율성의 밸런스 좋음
- 따라서 가장 많이 사용하는 구성

** 보안레벨에 맞춰 복수의 DMZ를 구성


* 필터링 방식으로 본 FW의 분류
** 패킷필터형
- 스태픽 패킷 필터형
- 인터넷 계층에서 필터링
- 필터링이 OS레벨에서 이루어지고 파이어월이 커넥션을 확립하지 않기 때문에 처리효율이 높다.
- 안이한 설정에 의해 부정 접속을 허용할 가능성이 있다. 
- 심플한 접근 제어 밖에 안되므로 복잡한 처리가 필요한 프로토콜에 대응하기 어렵다.
- 접근제어 룰이 복잡해지면 ACL 이 번잡하게 되어 설정 미스가 발생할 가능성이 높아진다.


*** ACL 예
- ACL은 위에서부터 순서대로 참조되어, 조건에 맞는 룰이 발견된 시점에 실행되어 이후의 룰은 참조하지 않게 된다. 
- 따라서 우선순위가 높은 룰은 위에 기술할 필요가 있다. 
- 또한, 아웃바운드 방향과 인바운드 방향 두 개의 룰을 짝지어서 등록할 필요가 있다. 
- 이 때 대응하는 두 번째의 룰은 ACK을 ON으로 설정할 필요가 있다. 


*** 필터링 설정 시의 유의점
다음과 같은 조건에 맞는 어플리케이션에 대해서는 비교적 안전하게 필터링이 됨
- 목적지 포토번호가 고정되어 있다.
- 클라이언트에서 서버 방향으로만 세션확립이 되고 반대 방향으로는 세션확립이 되지 않는다. 
- 출발지 IP, 포트번호가 변환되어도 문제가 없다.
- 페이로드 내부에 IP나 포트번호가 포함되어 있지 않다.

** 어플리케이션 게이트웨이형
- 

** 서킷 레벨 게이트웨이형

** 다이내믹 패킷 필터형

** 스테이트풀 인스펙션형

*** 어플리케이션 룰 설정에 있어서의 사고방식
**** 포지티브 세큐리티 모델
디폴트로는 모두 거부, 허가할 룰(화이트 리스트)만 등록


**** 네가티브 세큐리티 모델
디폴트로는 모두 허용, 거부할 룰(블랙 리스트)을 등록


* 파이어 월의 주소변환 기능
일반적으로 파이어월이나 루터에는 글로벌 주소를 프라이빗 주소로 변환하는 기능이 있다. 

** NAT


** NAPT

* 파이어 월로 방어하지 못하는 공격



* 파이어 월의 확장 기능

** 하이퍼포먼스

** 기가비트 대응

** 멀티 호밍 대응

** IPv6 대응

** QoS(Quality of Service)

** 고가용성(하이어베일러빌리티, HA)

*** 부담 분산 방식

*** 핫 스탠바이 방식

*** 자기 부담 분산 방식

** 부담분산기능

** 멀티 세그먼트 기능

** 어플리케이션 계층의 공격에 대한 방어 기능


